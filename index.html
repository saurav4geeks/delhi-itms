<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Delhi ITMS</title>
    <!-- Bootstrap  5.2 stylesheet -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <!-- Stylesheet -->
    <link rel="stylesheet" href="./assets/style.css" />
  </head>
  <body>
    <header>
      <div class="header-content">
        <img src="./assets/logo.png" alt="" />
        <h2>Delhi ITMS Site Survey App</h2>
      </div>
    </header>
    <main>
      <div class="container-fluid">
        <div class="row">
          <div class="col-lg-3" style="margin-block: 10% 0">
            <div class="login-wrap">
              <h1 class="mb-4">Login</h1>
              <form id="formdetails">
                <div class="mb-3">
                  <input
                    type="text"
                    class="form-control w-75"
                    id="username"
                    name="email"
                    aria-describedby="emailHelp"
                    placeholder="User Email"
                  />
                </div>
                <div class="mb-4">
                  <input
                    type="password"
                    class="form-control w-75"
                    id="password"
                    name="pwd"
                    placeholder="Password"
                  />
                </div>
                <div id="successMessage"></div>
                <button  id="submitLoginForm" type="button" class="btn-custom w-75">Submit</button>
              </form>
            </div>
          </div>
          <div class="col-lg-9" style="margin-block: 4% 0">
            <div class="bg-img">
              <img src="./assets/bg.png" alt="" class="img-fluid" />
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- JavaScript Bundle with Popper -->
    <style>
      #successMessage{
      font-size: 20px;
      font-weight: bold;
      color: black;
    }

    </style>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery.validation/1.15.1/jquery.validate.min.js"></script>

    <script>

    $(document).ready(function() {
    $("#formdetails").validate({
    rules: {
    pwd: "required",
    email: {
    required: true,
    email: true
    }
    }
   });
    });


    $("#submitLoginForm").click(function(e){

        // e.preventDefault();
        // let formData = $('#junctionForm').serialize();
        let obj = {}
          obj["user_name"]= $("#username").val();
          obj["user_password"]= $("#password").val();
          

      $.ajax({
          url: "http://65.0.170.23/delhi_items/DelhiItmsWebservice/user_login_web",
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(obj),
          // dataType: 'json', // added data type
          // data: obj,
          success: function (response) {
              // let res = JSON.parse(response);

              if(response.isTrue == true) {

                  $("#successMessage").text("Login Successfully"); 
                  setTimeout(function(){
                    window.location.href = './home.html'
                  }, 2000);

              }else {
                  $("#successMessage").text("Login Failed"); 
              }

             console.log("success response",response);
             localStorage.setItem("user", JSON.stringify(response.data.user));
              
            //  window.location.href = window.location.origin + '/delhi_itms_web/home.html';
            // window.location.href = './home.html';
          },
          error: function (response) {
              // let res = JSON.parse(response);
              // console.log("Eror response",res);
          },
        }); 

    });
  
    </script>
  </body>
</html>
